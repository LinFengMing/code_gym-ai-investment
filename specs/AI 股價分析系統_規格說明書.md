# AI 股價分析系統 規格說明書

> **用途說明**: 本規格說明書作為AI提示語使用，將此完整內容提交給AI，AI將根據規格生成完整的應用程式碼。

## 📋 系統概述

### 系統名稱
【Code Gym】AI 股票趨勢分析系統 (美股與台股)

### 核心功能描述
建立一個基於網頁的股票技術分析工具，能夠：
1. **支援台股與美股**：自動識別股票代碼類型（數字=台股，英文=美股）
2. 獲取指定股票的歷史價格數據和技術指標（台股使用 FindMind API，美股使用 FMP API）
3. 繪製專業的K線圖、移動平均線圖表和RSI相對強弱指標圖表
4. 使用AI進行深度技術面分析和趨勢解讀（支援 OpenAI 和 Google Gemini）
5. 提供客觀的歷史數據分析和教育性技術指標說明
6. 顯示RSI超買超賣警告和分析

### 技術架構要求
- **界面框架**: 使用 Streamlit 框架
- **數據來源**:
  - **台股**: FindMind API (https://api.finmindtrade.com)
  - **美股**: Financial Modeling Prep (FMP) API
- **AI 模型**:
  - **預設**: OpenAI (GPT-4o-mini)
  - **備選**: Google Gemini (gemini-2.5-pro)
- **視覺化工具**: 互動式圖表 (使用 Plotly Graph Objects)
- **數據處理**: Pandas, NumPy
- **HTTP請求**: requests
- **日期處理**: datetime
- **AI套件**: google-generativeai (Google Gemini)
- **部署方式**: 可直接在瀏覽器中運行

## 🎯 功能需求規格

### F-001: 用戶界面設計
**基本要求**:
- 頁面標題: "AI 股票趨勢分析系統 (美股與台股)"，使用彩虹色分隔線 (divider="rainbow")
- 左側控制區包含：
  - 系統Logo "分析設定" (divider="rainbow")
  - 股票代碼輸入：用戶輸入股票代碼進行分析
    - **台股**：輸入數字代碼（如：2330, 2317）🇹🇼
    - **美股**：輸入英文代碼（如：TSLA, MSFT, GOOGL）🇺🇸
    - 預設值: "TSLA"
    - 系統自動偵測股票類型並顯示對應提示
  - **動態API Key輸入**（根據股票類型自動切換）：
    - **台股時顯示**：FindMind API Key（可選填，type="password"）
      - 若為空，不使用 Authorization Header（允許免費額度）
    - **美股時顯示**：FMP API Key（必填，type="password"）
  - **AI 分析設定**：
    - 選擇 AI 提供商：下拉選單（預設：OpenAI）
      - 選項順序：`["openai", "gemini"]`
      - 預設選擇：OpenAI (`index=0`)
    - **動態AI API Key輸入**（根據選擇自動切換）：
      - **選擇 Gemini 時**：Google Gemini API Key（可選填，type="password"）
      - **選擇 OpenAI 時**：OpenAI API Key（可選填，type="password"）
      - 若為空，不執行 AI 分析，顯示友善提示訊息
  - 起始日期選擇：用戶選擇分析起始日期（預設為90天前）
  - 結束日期選擇：用戶選擇分析結束日期（預設為今天）
  - RSI計算天數：用戶輸入RSI計算天數（預設值: 14天）
- 主要執行按鈕: "開始分析"

### F-002: 數據獲取功能
**功能目標**: 根據股票代碼類型自動選擇對應的API獲取股票歷史價格數據
**用戶操作**: 用戶輸入股票代碼和日期範圍後，系統自動識別股票類型並取得相關數據

**股票類型自動識別**:
- **台股判斷**：股票代碼為純數字（如：2330, 2317）
- **美股判斷**：股票代碼包含英文字母（如：TSLA, MSFT, GOOGL）

**數據來源與說明**:

1. **台股數據來源 - FindMind API**:
   - API網址: `https://api.finmindtrade.com/api/v4/data`
   - 參數：
     - `dataset`: `TaiwanStockPrice`
     - `data_id`: 股票代碼（如：2330）
     - `start_date`: 起始日期（格式：YYYY-MM-DD）
     - `end_date`: 結束日期（格式：YYYY-MM-DD）
   - Headers:
     - `User-Agent`: 瀏覽器標識
     - `Authorization`: `Bearer {api_key}`（僅當 API Key 不為空時加入）
   - 數據欄位映射：
     - `Trading_Volume` → `volume`
     - `max` → `high`
     - `min` → `low`
     - `open` → `open`
     - `close` → `close`
     - `date` → `date`
   - API Key 可選填：若為空，不使用 Authorization Header（允許免費額度）

2. **美股數據來源 - Financial Modeling Prep (FMP) API**:
   - API網址: `https://financialmodelingprep.com/stable/historical-price-eod/full`
   - 參數：
     - `symbol`: 股票代碼（如：TSLA）
     - `apikey`: FMP API Key（必填）
   - 數據欄位：開盤價(open)、最高價(high)、最低價(low)、收盤價(close)、成交量(volume)

**數據範圍**:
- 價格數據: 包含開盤價(open)、最高價(high)、最低價(low)、收盤價(close)
- 成交量數據: 每日交易量(volume)
- 時間範圍: 根據用戶選擇的起始和結束日期

**處理要求**:
- 自動識別股票代碼類型（數字=台股，英文=美股）
- 根據股票類型選擇對應的API和參數
- 自動檢查API響應的有效性
- 提供友善的錯誤提示當API調用失敗時
- 驗證股票代碼格式的正確性
- 統一數據格式，確保後續處理一致
- FindMind API 請求需包含 User-Agent 和適當的 Headers
- 支援 FindMind API Key 為空的情況（免費額度）

### F-003: 數據處理與計算
**處理目標**: 將原始價格數據轉換為技術分析用的指標數據
**計算項目**:
- MA5: 5日移動平均線，計算最近5個交易日收盤價的平均值
- MA10: 10日移動平均線，計算最近10個交易日收盤價的平均值
- MA20: 20日移動平均線，計算最近20個交易日收盤價的平均值
- MA60: 60日移動平均線，計算最近60個交易日收盤價的平均值
- RSI: 相對強弱指標，計算公式為 RSI = 100 - (100 / (1 + RS))，其中RS = N日平均漲幅 / N日平均跌幅（N預設為14天，可自訂）
  - 計算步驟：
    1. 計算每日價格變化（收盤價相較前一日）
    2. 分別計算上漲日和下跌日的價格變化
    3. 計算N日平均漲幅和N日平均跌幅
    4. 計算RS值（平均漲幅/平均跌幅）
    5. 計算RSI值（100 - (100 / (1 + RS))）
  - 超買超賣判斷：
    - RSI > 70：超買狀態，顯示超買警告
    - RSI < 30：超賣狀態，顯示超賣警告
**通用品質要求**:
- 計算結果準確可靠，符合技術分析專業標準
- 妥善處理資料缺失和異常值情況，使用Pandas的rolling函數
- 確保歷史資料時間序列的一致性，按日期升序排列
- 實施適當的數據驗證機制，檢查數據完整性
- 保持數據處理的可追溯性，顯示數據處理步驟
- RSI計算需支援自訂參數（計算天數），並有完整的錯誤處理機制

### F-004: 主要顯示區域設計
**雙區域設計**: 主要內容區域包含以下要素
1. "股價K線圖與技術指標": 顯示互動式K線圖表和移動平均線（上方區域）
2. "RSI相對強弱指標圖表": 顯示RSI走勢圖和超買超賣區域（下方區域）
3. "基本統計資訊": 顯示期間價格變化的關鍵數據
4. "AI技術分析": 顯示AI生成的專業技術分析報告
5. "歷史數據表格": 顯示最近10筆交易日的詳細數據

#### 股價K線圖與技術指標詳細內容（上方區域）：
- 主要指標: K線圖(開高低收)、MA5、MA10、MA20、MA60移動平均線
- 主要圖表: 使用Plotly Graph Objects繪製Candlestick K線圖
- 顯示數據: 收盤價、移動平均線、成交量
- 互動功能: 縮放、平移、懸停顯示詳細價格資訊
- 視覺提示: 不同顏色的移動平均線，清晰的K線顏色區分
- 圖表標題: 顯示股票代碼和分析期間
- 軸標籤: X軸為日期，Y軸為價格
- 圖例設置: 水平排列在圖表上方，包含K線圖和各條移動平均線

#### RSI相對強弱指標圖表詳細內容（下方區域）：
- 主要指標: RSI相對強弱指標線圖
- 主要圖表: 使用Plotly Graph Objects繪製RSI線圖
- 顯示數據: RSI數值（範圍0-100）
- 圖表樣式:
  - RSI線條使用藍色
  - 在RSI=70處繪製紅色虛線（超買線）
  - 在RSI=30處繪製紅色虛線（超賣線）
  - 超買區域（RSI > 70）使用紅色背景填充
  - 超賣區域（RSI < 30）使用綠色背景填充
- 互動功能: 縮放、平移、滑鼠懸停顯示RSI數值
- 視覺提示: 當RSI>70時顯示超買警告標記，RSI<30時顯示超賣警告標記
- 圖表標題: 顯示"RSI相對強弱指標"和計算天數
- 軸標籤: X軸為日期，Y軸為RSI數值（範圍0-100）
- 圖例設置: 顯示RSI線、超買線、超賣線

### F-005: 基本資訊展示
**展示方式**: 使用 st.columns(3) 展示重要的價格統計資訊
**展示內容**:
- 第一欄: 起始價格 - 分析期間第一個交易日的收盤價
- 第二欄: 結束價格 - 分析期間最後一個交易日的收盤價
- 第三欄: 價格變化 - 顯示期間漲跌幅百分比和絕對變化
**通用數值處理**:
- **貨幣符號動態顯示**：
  - 台股：使用 "NT$" 前綴
  - 美股：使用 "$" 前綴
- 價格使用適當的小數位數（.2f格式）
- 百分比顯示到小數點後2位
- 使用 st.metric() 展示關鍵指標，包含 delta 變化值和漲跌方向

### F-006: AI分析功能
**分析目標**: 使用人工智慧對股票技術數據進行專業分析
**AI角色設定**: 專業的技術分析師，精通股票技術分析和歷史數據解讀，提供純教育性和客觀的技術分析

**AI 提供商選擇**:
- **預設選擇**: OpenAI (GPT-4o-mini)
  - 穩定可靠，回應品質一致
  - 適合日常技術分析
  - 商業級穩定性，適合長期使用
- **備選選項**: Google Gemini (gemini-2.5-pro)
  - 免費額度高，適合新手和頻繁使用
  - 推理能力強，適合深度技術分析
  - 無需信用卡綁定，降低使用門檻

**數據準備**：
- 將API獲取的原始價格數據（台股或美股），經過移動平均線計算處理後，組合成完整的技術分析數據集
- **Gemini 優化**：只傳送最近 30 天數據以減少輸入 token，同時提供關鍵統計摘要
- **輸出限制**：Gemini 輸出 token 限制提升至 8000，確保分析完整性
**完整AI提示語結構**:
```
## 系統角色 (System Message)
你是一位專業的技術分析師，專精於股票技術分析和歷史數據解讀。你的職責包括：

1. 客觀描述股票價格的歷史走勢和技術指標狀態
2. 解讀歷史市場數據和交易量變化模式
3. 識別技術面的歷史支撐阻力位
4. 提供純教育性的技術分析知識

重要原則：
- 僅提供歷史數據分析和技術指標解讀，絕不提供任何投資建議或預測
- 保持完全客觀中立的分析態度
- 使用專業術語但保持易懂
- 所有分析僅供教育和研究目的
- 強調技術分析的局限性和不確定性
- 使用繁體中文回答

嚴格的表達方式要求：
- 使用「歷史數據顯示」、「技術指標反映」、「過去走勢呈現」等客觀描述
- 避免「可能性」、「預期」、「建議」、「關注」等暗示性用詞
- 禁用「如果...則...」的假設句型，改用「歷史上當...時，曾出現...現象」
- 不提供具體價位的操作參考點，僅描述技術位階的歷史表現
- 強調「歷史表現不代表未來結果」
- 避免任何可能被解讀為操作指引的表達

免責聲明：所提供的分析內容純粹基於歷史數據的技術解讀，僅供教育和研究參考，不構成任何投資建議或未來走勢預測。歷史表現不代表未來結果。

## 用戶提示語 (User Prompt)
請基於以下股票歷史數據進行深度技術分析：

### 基本資訊
- 股票代號：{symbol}
- 股票類型：{stock_type}（台股/美股）
- 分析期間：{first_date} 至 {last_date}
- 期間價格變化：{price_change:.2f}% (從 {currency}{start_price:.2f} 變化到 {currency}{end_price:.2f})

### 交易數據
以下是該期間的交易數據（最近30天 + 關鍵統計），包含日期、開盤價、最高價、最低價、收盤價、成交量、移動平均線和RSI指標：
{data_json}

### 關鍵統計摘要
- 期間最高價：{currency}{price_high:.2f}
- 期間最低價：{currency}{price_low:.2f}
- 平均成交量：{avg_volume:,.0f}
- 當前RSI：{current_rsi:.2f}
- 當前MA5：{currency}{current_ma5:.2f}
- 當前MA20：{currency}{current_ma20:.2f}

### 請提供以下分析（請完整回答每個部分）：

1. **趨勢分析**：整體方向、支撐阻力位
2. **技術指標**：MA均線關係、RSI狀態、成交量分析
3. **價格行為**：關鍵突破點、波動性
4. **風險評估**：當前風險等級、支撐阻力區間
5. **技術觀察**：短中期觀察重點

請確保分析內容完整且詳細（至少800字），包含具體數據支撐，使用繁體中文，條理清晰。

分析目標：{symbol}
```

**AI API 實作要求**:
- **Google Gemini**:
  - 使用 `google-generativeai` 套件（或 `google.genai` 新版本）
  - 模型：`gemini-2.5-pro`
  - 配置：`temperature=0.3`, `max_output_tokens=8000`
  - 回應解析：支援 `response.text`, `response.parts`, `response.candidates`
  - 錯誤處理：檢查回應長度，若過短（<50字元）顯示警告
- **OpenAI**:
  - 使用 `openai` 套件
  - 模型：`gpt-4o-mini`
  - 配置：`temperature=0.3`
  - 錯誤處理：API 調用失敗時顯示友善提示

**AI提示語模板設計原則**:
- 系統角色要明確技術分析專業背景和客觀分析風格
- 用戶提示語要包含完整的技術分析架構和步驟
- 每個分析階段都要有具體的技術指標要求和解讀標準
- 要求AI輸出結構化格式，便於閱讀理解
- 包含適當的風險提醒和教育性免責聲明
- **Gemini 優化**：精簡提示語，減少輸入 token，明確要求至少800字完整回應
- **統一提示語**：OpenAI 和 Gemini 使用相同的提示語模板，確保分析品質一致

### F-007: 輔助功能
**進度顯示**:
- 使用 st.spinner("AI 正在分析中...") 顯示AI分析進度
- 使用 st.info() 顯示數據獲取和處理狀態
- 長時間操作要有明確的進度提示
**數據表格展示**:
- 使用 st.dataframe() 顯示最近10筆交易數據的詳細表格
- 按日期降序排列，最新數據在前
- 包含日期、開盤、最高、最低、收盤、成交量、移動平均線和RSI指標欄位
**狀態管理**:
- 使用 st.info() 顯示分析進度和數據處理狀態
- 實施適當的載入動畫和等待提示
- 檢查數據量大小並給予適當警告
**通用狀態反饋標準**:
- st.success() 用於分析完成確認
- st.error() 用於API錯誤、股票代碼錯誤等，提供具體解決建議
- st.warning() 用於數據量過大警告和操作建議
- st.info() 用於分析進度和數據獲取狀態

### F-008: 錯誤處理與用戶體驗
**通用輸入驗證標準**:
- 檢查股票代碼是否為空
- 驗證起始日期不能晚於結束日期
- **API Key 驗證**：
  - FindMind API Key：可選填（若為空，不使用 Authorization Header）
  - FMP API Key：必填（美股）
  - AI API Key：可選填（若為空，不執行 AI 分析，顯示友善提示）
- 提供股票代碼輸入範例和格式說明
  - 台股範例：2330, 2317（數字代碼）
  - 美股範例：TSLA, MSFT, GOOGL（英文代碼）

**通用錯誤處理標準**:
- 所有API調用都要有 try-catch 錯誤處理
- **FindMind API**：
  - 連線問題要有適當的錯誤提示
  - 400 Bad Request 錯誤要提供詳細的除錯資訊
  - 支援無 API Key 的免費額度使用
- **FMP API**：
  - 連線問題要有適當的錯誤提示
  - 股票代碼不存在時要有清楚的說明
- **AI API**：
  - OpenAI API 調用失敗要有友善的錯誤提示和解決建議
  - Gemini API 調用失敗要有友善的錯誤提示
  - Gemini 回應過短時要顯示警告和可能原因
  - AI API Key 為空時顯示友善提示，不影響其他功能

**通用用戶指導標準**:
- 提供股票代碼輸入範例和類型說明
  - 台股：數字代碼（如：2330, 2317）🇹🇼
  - 美股：英文代碼（如：TSLA, MSFT, GOOGL）🇺🇸
- 在日期選擇器旁提供操作說明
- 解釋各個技術指標的用途和意義
- 提供API金鑰獲取的指引連結
  - FindMind API：https://finmindtrade.com/
  - FMP API：https://financialmodelingprep.com/developer/docs
   - Google Gemini API：https://aistudio.google.com/app/apikey
  - OpenAI API：https://platform.openai.com/（預設）

### F-009: 免責聲明與安全
**免責聲明位置**: 在側邊欄底部 (st.sidebar.markdown)
**通用免責聲明模板**:
```markdown
### 📢 免責聲明
本系統僅供學術研究與教育用途，AI 提供的數據與分析結果僅供參考，**不構成投資建議或財務建議**。
請使用者自行判斷投資決策，並承擔相關風險。本系統作者不對任何投資行為負責，亦不承擔任何損失責任。
```
**通用安全要求**:
- API金鑰使用 type="password" 安全輸入
- 不在程式碼中寫入敏感資訊
- 實施適當的輸入清理和驗證
- 避免資料外洩和隱私洩露

## 🎨 界面設計與體驗標準
### 整體風格要求
- **專業感**: 界面要看起來專業可信，符合金融分析工具標準
- **易用性**: 操作要簡單直觀，適合各種技術水平的用戶使用
- **美觀性**: 配色和排版要美觀舒適，使用Streamlit的現代化設計
- **一致性**: 各部分風格要統一，保持視覺和操作的連貫性

### 操作流程設計標準
1. **進入系統**: 用戶看到清晰的標題和股票分析工具介紹
2. **輸入階段**: 側邊欄提供邏輯性的輸入順序（股票代碼→API金鑰→日期範圍）
3. **執行階段**: 明確的"分析"按鈕和適當的進度回饋
4. **結果展示**: 分層次的結果呈現，從圖表到數據到AI分析
5. **進階操作**: 支援調整日期範圍和重新分析的能力

### 通用視覺化標準
- **圖表工具**: 統一使用 Plotly Graph Objects 繪製K線圖和RSI圖表
- **色彩配置**: 遵循金融圖表的標準配色（紅綠K線、不同顏色的移動平均線、RSI藍色線條、超買超賣區域背景色）
- **圖表佈局**: 使用subplot功能將K線圖和RSI圖表分為上下兩個區域顯示
- **互動功能**: 支援縮放、平移、懸停顯示價格詳情和RSI數值
- **響應式設計**: 使用 use_container_width=True 確保圖表適配
- **載入優化**: 大型數據集要有適當的載入提示和警告

### 通用佈局標準
- **側邊欄寬度**: 保持適中，包含所有必要的輸入控制項
- **欄位間距**: 使用 st.columns(3) 展示基本統計資訊
- **垂直間距**: 適當使用分隔線和空間分隔不同功能區塊
- **內容密度**: 避免資訊過於擁擠，保持清晰的視覺層次

## 📊 品質標準
### 功能品質標準
- 所有主要功能都要能穩定運作，包括API調用和數據處理
- 技術指標計算要準確可靠，與專業金融軟體保持一致
- AI分析要有價值且負責任，避免投資建議和誤導性內容
- 用戶操作要流暢無阻礙，響應時間控制在合理範圍

### 界面品質標準
- K線圖要清晰美觀，符合專業技術分析圖表標準
- 文字要清晰易讀，技術術語要有適當說明
- 操作要直觀簡單，符合用戶對金融工具的使用習慣
- 錯誤提示要友善有用，提供可操作的解決方案

### 效能品質標準
- 初始載入時間控制在 3 秒內
- API數據獲取和處理在 10 秒內完成
- AI分析響應時間控制在 30 秒內
- 支援主流瀏覽器，在不同設備上都能正常運行

### 安全品質標準
- API金鑰要安全處理，不在前端暴露
- 用戶輸入要經過適當的驗證和清理
- 避免常見的網路安全漏洞
- 遵循數據隱私和保護的最佳實踐

## AI實作指令
**請根據以上完整規格說明書，生成一個完整可運行的 Streamlit 網頁應用程式。**

### 必要實現要求
1. **完全實現所有功能需求** (F-001 到 F-009)
2. **符合通用界面設計標準** - 專業、易用、美觀、一致
3. **滿足通用品質標準** - 功能、界面、效能、安全
4. **具備金融分析專業水準** - 符合技術分析工具的專業標準

### 技術實現要求
- **框架**: 使用 Streamlit 框架建立網頁界面
- **API整合**:
  - 整合 FindMind API（台股）和 Financial Modeling Prep API（美股）
  - 實施完整錯誤處理和動態API選擇
- **AI分析**:
  - **預設**: OpenAI (GPT-4o-mini)
  - **備選**: Google Gemini (gemini-2.5-pro)
  - 按照統一的提示語模板進行技術分析
- **視覺化**: 使用 Plotly Graph Objects 創建專業K線圖和移動平均線
- **程式品質**: 程式碼要清晰易懂，有適當的中文註釋
- **套件依賴**:
  - `google-generativeai` 或 `google.genai`（Google Gemini）
  - `openai`（OpenAI）

### 特別注意事項
- 程式必須完整可執行，可直接用 `streamlit run` 運行
- 所有用戶輸入都要有驗證和友善的錯誤處理
- AI 分析內容要客觀專業，避免投資建議和過度承諾
- K線圖要符合專業技術分析的視覺標準
- 免責聲明要清楚顯示，提醒用戶合理使用

### 程式結構要求
**主要函數需求**:
1. `is_taiwan_stock(symbol)` - 判斷股票代碼是否為台股（數字=台股，英文=美股）
2. `get_taiwan_stock_data(symbol, api_key, start_date, end_date)` - 從 FindMind API 獲取台股歷史數據
3. `get_us_stock_data(symbol, api_key, start_date, end_date)` - 從 FMP API 獲取美股歷史數據
4. `get_stock_data(symbol, api_key, start_date, end_date)` - 統一入口，根據股票類型自動選擇對應API
5. `filter_by_date_range(df, start_date, end_date)` - 根據日期範圍過濾數據
6. `get_moving_averages(df)` - 計算移動平均線（MA5, MA10, MA20, MA60）
7. `calculate_rsi(df, period=14)` - 計算RSI相對強弱指標（預設14天，支援自訂參數）
8. `generate_ai_insights(symbol, stock_data, ai_api_key, ai_provider, start_date, end_date)` - 使用 AI 進行技術分析
   - 支援 OpenAI 和 Google Gemini
   - 需包含 RSI 數據和關鍵統計摘要
   - Gemini 優化：只傳送最近30天數據

**主程式邏輯**:
1. 設置頁面標題「AI 股票趨勢分析系統 (美股與台股)」和側邊欄輸入控制項
2. 股票代碼輸入和自動類型識別（數字=台股，英文=美股）
3. 動態顯示對應的 API Key 輸入框（FindMind 或 FMP）
4. AI 提供商選擇（預設：OpenAI）
5. 動態顯示對應的 AI API Key 輸入框（OpenAI 或 Gemini）
6. 實施輸入驗證和錯誤處理（包含 RSI 參數驗證）
7. 根據股票類型獲取和處理股票數據（FindMind 或 FMP API）
8. 計算移動平均線和 RSI 指標
9. 繪製互動式K線圖和移動平均線（上方區域）
   - 動態顯示貨幣符號（台股：NT$，美股：$）
10. 繪製RSI相對強弱指標圖表（下方區域，包含超買超賣區域標記）
11. 顯示基本統計資訊（動態貨幣符號）
12. 執行AI技術分析（根據選擇的 AI 提供商，包含 RSI 分析內容）
    - 若 AI API Key 為空，顯示友善提示，不影響其他功能
13. 顯示歷史數據表格（包含RSI欄位）

### 交付物要求
**最終交付物**: 一個完整的 Python 程式檔案，包含：
- 所有必要的 import 語句：
  - `streamlit` - 網頁界面框架
  - `requests` - HTTP 請求
  - `pandas`, `numpy` - 數據處理
  - `plotly.graph_objects` - 圖表繪製
  - `openai` - OpenAI API
  - `google.generativeai` 或 `google.genai` - Google Gemini API
  - `datetime`, `json` - 日期和JSON處理
  - `io`, `sys` - 系統工具（如需要）
- 完整的函數實現，對應上述主要函數
- 主程式邏輯，實現完整的用戶界面和功能
- 適當的中文註釋和說明
- 可以直接執行的完整程式碼，無需額外修改
- **套件依賴**: 需在 `pyproject.toml` 或 `requirements.txt` 中聲明 `google-generativeai>=0.8.0`